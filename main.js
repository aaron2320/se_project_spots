!function(){"use strict";const e={formSelector:".modal__form",inputSelector:".modal__input",submitButtonSelector:".modal__submit-btn",inactiveButtonClass:"modal__submit-btn_disabled",inputErrorClass:"modal__input_type_error",errorClass:"modal__error"},t=(e,t,r)=>{e.querySelector(`#${t.id}-error`).textContent="",t.classList.remove(r.inputErrorClass)},r=(e,t,r)=>{(e=>e.some((e=>!e.validity.valid)))(e)?(t.disabled=!0,t.classList.add(r.inactiveButtonClass)):(t.disabled=!1,t.classList.remove(r.inactiveButtonClass))},n=(e,r)=>{Array.from(e.querySelectorAll(r.inputSelector)).forEach((n=>t(e,n,r)))},o=new class{constructor(e){let{baseUrl:t,headers:r}=e;this.baseUrl=t,this.headers=r}_checkResponse(e){return e.ok?e.json():e.text().then((t=>{throw new Error(`HTTP error! Status: ${e.status} - ${t}`)}))}getAppInfo(){return Promise.all([this.getUserInfo(),this.getInitialCards()]).then((e=>{let[t,r]=e;return{user:t,cards:r}}))}getUserInfo(){return fetch(`${this.baseUrl}/users/me`,{headers:this.headers}).then(this._checkResponse)}getInitialCards(){return fetch(`${this.baseUrl}/cards`,{headers:this.headers}).then(this._checkResponse)}editUserInfo(e){let{name:t,about:r}=e;return fetch(`${this.baseUrl}/users/me`,{method:"PATCH",headers:this.headers,body:JSON.stringify({name:t,about:r})}).then(this._checkResponse)}addCard(e){let{name:t,link:r}=e;return fetch(`${this.baseUrl}/cards`,{method:"POST",headers:this.headers,body:JSON.stringify({name:t,link:r})}).then(this._checkResponse)}removeCard(e){return fetch(`${this.baseUrl}/cards/${e}`,{method:"DELETE",headers:this.headers}).then(this._checkResponse)}addLike(e){return fetch(`${this.baseUrl}/cards/${e}/likes`,{method:"PUT",headers:this.headers}).then(this._checkResponse)}removeLike(e){return fetch(`${this.baseUrl}/cards/${e}/likes`,{method:"DELETE",headers:this.headers}).then(this._checkResponse)}updateAvatar(e){return fetch(`${this.baseUrl}/users/me/avatar`,{method:"PATCH",headers:this.headers,body:JSON.stringify({avatar:e})}).then(this._checkResponse)}}({baseUrl:"https://around-api.en.tripleten-services.com/v1",headers:{authorization:"eb9bb101-c854-4169-9f87-c5a28a8b7a33","Content-Type":"application/json"}}),a=document.querySelector(".profile__edit-btn"),s=document.querySelector(".profile__add-btn"),i=document.querySelector(".profile__name"),c=document.querySelector(".profile__description"),l=document.querySelector(".profile__avatar"),d=document.querySelector("#edit-modal"),u=document.querySelector("#add-card-modal"),m=document.querySelector("#preview-modal"),h=document.querySelector("#avatar-modal"),_=document.querySelector("#delete-modal"),v=document.forms["edit-profile-form"],p=document.forms["card-form"],f=document.forms["avatar-form"],y=document.forms["delete-form"],b=d.querySelector(".modal__close-btn"),k=u.querySelector(".modal__close-btn"),S=m.querySelector(".modal__close-btn"),L=h.querySelector(".modal__close-btn"),C=_.querySelector(".modal__close-btn"),q=_.querySelector(".modal__cancel-btn"),E=d.querySelector("#profile-name-input"),g=d.querySelector("#profile-description-input"),x=u.querySelector("#add-card-link-input"),$=u.querySelector("#card-caption-input"),U=h.querySelector("#avatar-url-input"),A=document.querySelector(".profile__edit-avatar-link"),I=document.querySelector(".profile__avatar-container"),D=document.querySelector("#card-template"),T=document.querySelector(".cards__list"),w=document.querySelector(".modal__image"),R=document.querySelector(".modal__caption");let P=null,F=null,B=null;function H(e){console.log("Creating card with data:",e);const t=D.content.querySelector(".card").cloneNode(!0),r=t.querySelector(".card__title"),n=t.querySelector(".card__image"),o=t.querySelector(".card__like-btn"),a=t.querySelector(".card__delete-btn");r.textContent=e.name,n.src=e.link,n.alt=e.name;const s=e.likes&&e.likes.some((e=>e._id===B));return console.log(`Card ${e._id} isLiked: ${s}`),s&&o.classList.add("card__like-btn_liked"),a.addEventListener("click",(()=>function(e,t){P=e,F=t._id,O(_)}(t,e))),o.addEventListener("click",j.bind(null,o,e)),n.addEventListener("click",(()=>{w.src=e.link,w.alt=e.name,R.textContent=e.name,O(m)})),t}function N(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"prepend";const r=H(e);T[t](r)}function O(e){e.classList.add("modal_opened"),document.addEventListener("keydown",M),e.addEventListener("mousedown",z),I.classList.remove("profile__avatar-container--active")}function J(e){e.classList.remove("modal_opened"),document.removeEventListener("keydown",M),e.removeEventListener("mousedown",z),I.classList.remove("profile__avatar-container--active")}function j(e,t){const r=e.classList.contains("card__like-btn_liked");console.log(`Like button clicked, isLiked: ${r}, Card ID: ${t._id}`),(r?o.removeLike.bind(o):o.addLike.bind(o))(t._id).then((t=>{console.log("Like update response:",t);const r=t.likes&&t.likes.some((e=>e._id===B));e.classList.toggle("card__like-btn_liked",r)})).catch((e=>console.error("Failed to update like:",e)))}function M(e){if("Escape"===e.key){const e=document.querySelector(".modal_opened");e&&J(e)}}function z(e){e.target.classList.contains("modal")&&J(e.target)}var G;a.addEventListener("click",(()=>{E.value=i.textContent,g.value=c.textContent,n(v,e),O(d)})),s.addEventListener("click",(()=>O(u))),A.addEventListener("click",(t=>{t.preventDefault(),U.value=l.src,n(f,e),O(h)})),b.addEventListener("click",(()=>J(d))),k.addEventListener("click",(()=>J(u))),S.addEventListener("click",(()=>J(m))),L.addEventListener("click",(()=>J(h))),C.addEventListener("click",(()=>J(_))),q.addEventListener("click",(()=>J(_))),v.addEventListener("submit",(function(e){e.preventDefault();const t=e.submitter,r=t.textContent;t.textContent="Saving...";const n=E.value,a=g.value;o.editUserInfo({name:n,about:a}).then((e=>{i.textContent=e.name,c.textContent=e.about,J(d)})).catch((e=>console.error("Failed to update profile:",e))).finally((()=>t.textContent=r))})),p.addEventListener("submit",(function(t){t.preventDefault();const n=t.submitter,a=n.textContent;n.textContent="Saving...";const s=$.value,i=x.value;o.addCard({name:s,link:i}).then((t=>{N(t),J(u),p.reset(),r([$,x],n,e)})).catch((e=>console.error("Failed to add card:",e))).finally((()=>n.textContent=a))})),f.addEventListener("submit",(function(e){e.preventDefault();const t=e.submitter,r=t.textContent;t.textContent="Saving...";const n=U.value;o.updateAvatar(n).then((e=>{l.src=e.avatar,J(h)})).catch((e=>console.error("Failed to update avatar:",e))).finally((()=>t.textContent=r))})),y.addEventListener("submit",(function(e){e.preventDefault();const t=e.submitter,r=t.textContent;t.textContent="Saving...",o.removeCard(F).then((()=>{P.remove(),J(_),P=null,F=null})).catch((e=>console.error("Failed to delete card:",e))).finally((()=>t.textContent=r))})),I.addEventListener("touchstart",(e=>{I.classList.toggle("profile__avatar-container--active")})),document.addEventListener("touchstart",(e=>{I.contains(e.target)||I.classList.remove("profile__avatar-container--active")})),o.getAppInfo().then((e=>{let{user:t,cards:r}=e;console.log("API User Data:",t),console.log("API Cards Data:",r),B=t._id,i.textContent=t.name,c.textContent=t.about,l.src=t.avatar,T.innerHTML="",r.forEach((e=>N(e,"append")))})).catch((e=>console.error("Failed to load initial data:",e))),G=e,document.querySelectorAll(G.formSelector).forEach((e=>((e,n)=>{const o=Array.from(e.querySelectorAll(n.inputSelector)),a=e.querySelector(n.submitButtonSelector);r(o,a,n),e.addEventListener("reset",(()=>{r(o,a,n)})),o.forEach((s=>{s.addEventListener("input",(()=>{((e,r,n)=>{r.validity.valid?t(e,r,n):((e,t,r,n)=>{e.querySelector(`#${t.id}-error`).textContent=r,t.classList.add(n.inputErrorClass)})(e,r,r.validationMessage,n)})(e,s,n),r(o,a,n)}))}))})(e,G)))}();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QWlCLFNBQVMsS0FDL0I5RyxFQUFrQkMsRUFBV2tKLEVBQWV6SixFQUFPLElBR3JETyxFQUFVYSxTQUFTc0ksSUFDakJBLEVBQWF0QyxpQkFBaUIsU0FBUyxLQXRDaEJ1QyxFQUFDN0osRUFBUUMsRUFBU0MsS0FDdENELEVBQVFZLFNBQVNDLE1BR3BCZixFQUFlQyxFQUFRQyxFQUFTQyxHQWhCYjRKLEVBQUM5SixFQUFRQyxFQUFTOEosRUFBVTdKLEtBQzlCRixFQUFPRyxjQUFjLElBQUlGLEVBQVFHLFlBQ3pDQyxZQUFjMEosRUFDekI5SixFQUFRSyxVQUFVVyxJQUFJZixFQUFPTCxnQkFBZ0IsRUFXM0NpSyxDQUFlOUosRUFBUUMsRUFBU0EsRUFBUStKLGtCQUFtQjlKLEVBRzdELEVBa0NJMkosQ0FBbUI3SixFQUFRNEosRUFBYzFKLEdBQ3pDTSxFQUFrQkMsRUFBV2tKLEVBQWV6SixFQUFPLEdBQ25ELEdBQ0YsRUFLMkJ3SixDQUFrQjFKLEVBQVFFLEkiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9zZV9wcm9qZWN0X3Nwb3RzLy4vc3JjL3NjcmlwdHMvdmFsaWRhdGlvbi5qcyIsIndlYnBhY2s6Ly9zZV9wcm9qZWN0X3Nwb3RzLy4vc3JjL3BhZ2VzL2luZGV4LmpzIiwid2VicGFjazovL3NlX3Byb2plY3Rfc3BvdHMvLi9zcmMvdXRpbHMvQXBpLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImNvbnN0IHNldHRpbmdzID0ge1xuICBmb3JtU2VsZWN0b3I6IFwiLm1vZGFsX19mb3JtXCIsXG4gIGlucHV0U2VsZWN0b3I6IFwiLm1vZGFsX19pbnB1dFwiLFxuICBzdWJtaXRCdXR0b25TZWxlY3RvcjogXCIubW9kYWxfX3N1Ym1pdC1idG5cIixcbiAgaW5hY3RpdmVCdXR0b25DbGFzczogXCJtb2RhbF9fc3VibWl0LWJ0bl9kaXNhYmxlZFwiLFxuICBpbnB1dEVycm9yQ2xhc3M6IFwibW9kYWxfX2lucHV0X3R5cGVfZXJyb3JcIixcbiAgZXJyb3JDbGFzczogXCJtb2RhbF9fZXJyb3JcIixcbn07XG5cbmNvbnN0IHNob3dJbnB1dEVycm9yID0gKGZvcm1FbCwgaW5wdXRFbCwgZXJyb3JNc2csIGNvbmZpZykgPT4ge1xuICBjb25zdCBlcnJvck1zZ0VsID0gZm9ybUVsLnF1ZXJ5U2VsZWN0b3IoYCMke2lucHV0RWwuaWR9LWVycm9yYCk7XG4gIGVycm9yTXNnRWwudGV4dENvbnRlbnQgPSBlcnJvck1zZztcbiAgaW5wdXRFbC5jbGFzc0xpc3QuYWRkKGNvbmZpZy5pbnB1dEVycm9yQ2xhc3MpO1xufTtcblxuY29uc3QgaGlkZUlucHV0RXJyb3IgPSAoZm9ybUVsLCBpbnB1dEVsLCBjb25maWcpID0+IHtcbiAgY29uc3QgZXJyb3JNc2dFbCA9IGZvcm1FbC5xdWVyeVNlbGVjdG9yKGAjJHtpbnB1dEVsLmlkfS1lcnJvcmApO1xuICBlcnJvck1zZ0VsLnRleHRDb250ZW50ID0gXCJcIjtcbiAgaW5wdXRFbC5jbGFzc0xpc3QucmVtb3ZlKGNvbmZpZy5pbnB1dEVycm9yQ2xhc3MpO1xufTtcblxuY29uc3QgY2hlY2tJbnB1dFZhbGlkaXR5ID0gKGZvcm1FbCwgaW5wdXRFbCwgY29uZmlnKSA9PiB7XG4gIGlmICghaW5wdXRFbC52YWxpZGl0eS52YWxpZCkge1xuICAgIHNob3dJbnB1dEVycm9yKGZvcm1FbCwgaW5wdXRFbCwgaW5wdXRFbC52YWxpZGF0aW9uTWVzc2FnZSwgY29uZmlnKTtcbiAgfSBlbHNlIHtcbiAgICBoaWRlSW5wdXRFcnJvcihmb3JtRWwsIGlucHV0RWwsIGNvbmZpZyk7XG4gIH1cbn07XG5cbmNvbnN0IGhhc0ludmFsaWRJbnB1dCA9IChpbnB1dExpc3QpID0+IHtcbiAgcmV0dXJuIGlucHV0TGlzdC5zb21lKChpbnB1dCkgPT4gIWlucHV0LnZhbGlkaXR5LnZhbGlkKTtcbn07XG5cbmNvbnN0IHRvZ2dsZUJ1dHRvblN0YXRlID0gKGlucHV0TGlzdCwgYnV0dG9uRWwsIGNvbmZpZykgPT4ge1xuICBpZiAoaGFzSW52YWxpZElucHV0KGlucHV0TGlzdCkpIHtcbiAgICBidXR0b25FbC5kaXNhYmxlZCA9IHRydWU7XG4gICAgYnV0dG9uRWwuY2xhc3NMaXN0LmFkZChjb25maWcuaW5hY3RpdmVCdXR0b25DbGFzcyk7XG4gIH0gZWxzZSB7XG4gICAgYnV0dG9uRWwuZGlzYWJsZWQgPSBmYWxzZTtcbiAgICBidXR0b25FbC5jbGFzc0xpc3QucmVtb3ZlKGNvbmZpZy5pbmFjdGl2ZUJ1dHRvbkNsYXNzKTtcbiAgfVxufTtcblxuY29uc3QgcmVzZXRWYWxpZGF0aW9uID0gKGZvcm1FbCwgY29uZmlnKSA9PiB7XG4gIGNvbnN0IGlucHV0TGlzdCA9IEFycmF5LmZyb20oZm9ybUVsLnF1ZXJ5U2VsZWN0b3JBbGwoY29uZmlnLmlucHV0U2VsZWN0b3IpKTtcbiAgaW5wdXRMaXN0LmZvckVhY2goKGlucHV0RWwpID0+IGhpZGVJbnB1dEVycm9yKGZvcm1FbCwgaW5wdXRFbCwgY29uZmlnKSk7XG59O1xuXG5jb25zdCBzZXRFdmVudExpc3RlbmVycyA9IChmb3JtRWwsIGNvbmZpZykgPT4ge1xuICBjb25zdCBpbnB1dExpc3QgPSBBcnJheS5mcm9tKGZvcm1FbC5xdWVyeVNlbGVjdG9yQWxsKGNvbmZpZy5pbnB1dFNlbGVjdG9yKSk7XG4gIGNvbnN0IGJ1dHRvbkVsZW1lbnQgPSBmb3JtRWwucXVlcnlTZWxlY3Rvcihjb25maWcuc3VibWl0QnV0dG9uU2VsZWN0b3IpO1xuXG4gIHRvZ2dsZUJ1dHRvblN0YXRlKGlucHV0TGlzdCwgYnV0dG9uRWxlbWVudCwgY29uZmlnKTtcblxuICBmb3JtRWwuYWRkRXZlbnRMaXN0ZW5lcihcInJlc2V0XCIsICgpID0+IHtcbiAgICB0b2dnbGVCdXR0b25TdGF0ZShpbnB1dExpc3QsIGJ1dHRvbkVsZW1lbnQsIGNvbmZpZyk7XG4gIH0pO1xuXG4gIGlucHV0TGlzdC5mb3JFYWNoKChpbnB1dEVsZW1lbnQpID0+IHtcbiAgICBpbnB1dEVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImlucHV0XCIsICgpID0+IHtcbiAgICAgIGNoZWNrSW5wdXRWYWxpZGl0eShmb3JtRWwsIGlucHV0RWxlbWVudCwgY29uZmlnKTtcbiAgICAgIHRvZ2dsZUJ1dHRvblN0YXRlKGlucHV0TGlzdCwgYnV0dG9uRWxlbWVudCwgY29uZmlnKTtcbiAgICB9KTtcbiAgfSk7XG59O1xuXG5jb25zdCBlbmFibGVWYWxpZGF0aW9uID0gKGNvbmZpZykgPT4ge1xuICBjb25zdCBmb3JtTGlzdCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoY29uZmlnLmZvcm1TZWxlY3Rvcik7XG4gIGZvcm1MaXN0LmZvckVhY2goKGZvcm1FbCkgPT4gc2V0RXZlbnRMaXN0ZW5lcnMoZm9ybUVsLCBjb25maWcpKTtcbn07XG5cbi8vIEV4cG9ydCB0aGUgbmVjZXNzYXJ5IGZ1bmN0aW9ucyBhbmQgc2V0dGluZ3NcbmV4cG9ydCB7IGVuYWJsZVZhbGlkYXRpb24sIHNldHRpbmdzLCByZXNldFZhbGlkYXRpb24sIHRvZ2dsZUJ1dHRvblN0YXRlIH07IC8vIEFkZGVkIHRvZ2dsZUJ1dHRvblN0YXRlXG4iLCJpbXBvcnQgXCIuL2luZGV4LmNzc1wiO1xuaW1wb3J0IHtcbiAgZW5hYmxlVmFsaWRhdGlvbixcbiAgc2V0dGluZ3MsXG4gIHJlc2V0VmFsaWRhdGlvbixcbiAgdG9nZ2xlQnV0dG9uU3RhdGUsXG59IGZyb20gXCIuLi9zY3JpcHRzL3ZhbGlkYXRpb24uanNcIjtcbmltcG9ydCBBcGkgZnJvbSBcIi4uL3V0aWxzL0FwaS5qc1wiO1xuXG5jb25zdCBhcGkgPSBuZXcgQXBpKHtcbiAgYmFzZVVybDogXCJodHRwczovL2Fyb3VuZC1hcGkuZW4udHJpcGxldGVuLXNlcnZpY2VzLmNvbS92MVwiLFxuICBoZWFkZXJzOiB7XG4gICAgYXV0aG9yaXphdGlvbjogXCJlYjliYjEwMS1jODU0LTQxNjktOWY4Ny1jNWEyOGE4YjdhMzNcIixcbiAgICBcIkNvbnRlbnQtVHlwZVwiOiBcImFwcGxpY2F0aW9uL2pzb25cIixcbiAgfSxcbn0pO1xuXG4vLyBET00gRWxlbWVudHNcbmNvbnN0IHByb2ZpbGVFZGl0QnRuID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19lZGl0LWJ0blwiKTtcbmNvbnN0IGNhcmRNb2RhbEJ0biA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZV9fYWRkLWJ0blwiKTtcbmNvbnN0IHByb2ZpbGVOYW1lID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19uYW1lXCIpO1xuY29uc3QgcHJvZmlsZURlc2NyaXB0aW9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19kZXNjcmlwdGlvblwiKTtcbmNvbnN0IHByb2ZpbGVBdmF0YXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnByb2ZpbGVfX2F2YXRhclwiKTtcblxuY29uc3QgZWRpdE1vZGFsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNlZGl0LW1vZGFsXCIpO1xuY29uc3QgY2FyZE1vZGFsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNhZGQtY2FyZC1tb2RhbFwiKTtcbmNvbnN0IHByZXZpZXdNb2RhbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjcHJldmlldy1tb2RhbFwiKTtcbmNvbnN0IGF2YXRhck1vZGFsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNhdmF0YXItbW9kYWxcIik7XG5jb25zdCBkZWxldGVNb2RhbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjZGVsZXRlLW1vZGFsXCIpO1xuXG5jb25zdCBlZGl0Rm9ybUVsZW1lbnQgPSBkb2N1bWVudC5mb3Jtc1tcImVkaXQtcHJvZmlsZS1mb3JtXCJdO1xuY29uc3QgY2FyZEZvcm0gPSBkb2N1bWVudC5mb3Jtc1tcImNhcmQtZm9ybVwiXTtcbmNvbnN0IGF2YXRhckZvcm0gPSBkb2N1bWVudC5mb3Jtc1tcImF2YXRhci1mb3JtXCJdO1xuY29uc3QgZGVsZXRlRm9ybSA9IGRvY3VtZW50LmZvcm1zW1wiZGVsZXRlLWZvcm1cIl07XG5cbmNvbnN0IGVkaXRNb2RhbENsb3NlQnRuID0gZWRpdE1vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX2Nsb3NlLWJ0blwiKTtcbmNvbnN0IGNhcmRNb2RhbENsb3NlQnRuID0gY2FyZE1vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX2Nsb3NlLWJ0blwiKTtcbmNvbnN0IHByZXZpZXdNb2RhbENsb3NlQnRuID0gcHJldmlld01vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX2Nsb3NlLWJ0blwiKTtcbmNvbnN0IGF2YXRhck1vZGFsQ2xvc2VCdG4gPSBhdmF0YXJNb2RhbC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19jbG9zZS1idG5cIik7XG5jb25zdCBkZWxldGVNb2RhbENsb3NlQnRuID0gZGVsZXRlTW9kYWwucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9fY2xvc2UtYnRuXCIpO1xuY29uc3QgZGVsZXRlTW9kYWxDYW5jZWxCdG4gPSBkZWxldGVNb2RhbC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19jYW5jZWwtYnRuXCIpO1xuXG5jb25zdCBlZGl0TW9kYWxOYW1lSW5wdXQgPSBlZGl0TW9kYWwucXVlcnlTZWxlY3RvcihcIiNwcm9maWxlLW5hbWUtaW5wdXRcIik7XG5jb25zdCBlZGl0TW9kYWxEZXNjcmlwdGlvbklucHV0ID0gZWRpdE1vZGFsLnF1ZXJ5U2VsZWN0b3IoXG4gIFwiI3Byb2ZpbGUtZGVzY3JpcHRpb24taW5wdXRcIlxuKTtcbmNvbnN0IGNhcmRMaW5rSW5wdXQgPSBjYXJkTW9kYWwucXVlcnlTZWxlY3RvcihcIiNhZGQtY2FyZC1saW5rLWlucHV0XCIpO1xuY29uc3QgY2FyZENhcHRpb25JbnB1dCA9IGNhcmRNb2RhbC5xdWVyeVNlbGVjdG9yKFwiI2NhcmQtY2FwdGlvbi1pbnB1dFwiKTtcbmNvbnN0IGF2YXRhclVybElucHV0ID0gYXZhdGFyTW9kYWwucXVlcnlTZWxlY3RvcihcIiNhdmF0YXItdXJsLWlucHV0XCIpO1xuXG5jb25zdCBhdmF0YXJFZGl0TGluayA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZV9fZWRpdC1hdmF0YXItbGlua1wiKTtcbmNvbnN0IGF2YXRhckNvbnRhaW5lciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZV9fYXZhdGFyLWNvbnRhaW5lclwiKTtcblxuY29uc3QgY2FyZFRlbXBsYXRlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNjYXJkLXRlbXBsYXRlXCIpO1xuY29uc3QgY2FyZHNMaXN0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5jYXJkc19fbGlzdFwiKTtcblxuY29uc3QgcHJldmlld01vZGFsSW1hZ2UgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19pbWFnZVwiKTtcbmNvbnN0IHByZXZpZXdNb2RhbENhcHRpb24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19jYXB0aW9uXCIpO1xuXG4vLyBWYXJpYWJsZXMgZm9yIGRlbGV0ZSBmdW5jdGlvbmFsaXR5XG5sZXQgc2VsZWN0ZWRDYXJkID0gbnVsbDtcbmxldCBzZWxlY3RlZENhcmRJZCA9IG51bGw7XG5sZXQgdXNlcklkID0gbnVsbDsgLy8gU3RvcmUgdGhlIGN1cnJlbnQgdXNlcidzIElEXG5cbi8vIExvYWQgaW5pdGlhbCBkYXRhIGZyb20gQVBJXG5mdW5jdGlvbiBsb2FkSW5pdGlhbERhdGEoKSB7XG4gIGFwaVxuICAgIC5nZXRBcHBJbmZvKClcbiAgICAudGhlbigoeyB1c2VyLCBjYXJkcyB9KSA9PiB7XG4gICAgICBjb25zb2xlLmxvZyhcIkFQSSBVc2VyIERhdGE6XCIsIHVzZXIpO1xuICAgICAgY29uc29sZS5sb2coXCJBUEkgQ2FyZHMgRGF0YTpcIiwgY2FyZHMpO1xuICAgICAgdXNlcklkID0gdXNlci5faWQ7IC8vIFN0b3JlIHRoZSBjdXJyZW50IHVzZXIncyBJRFxuICAgICAgcHJvZmlsZU5hbWUudGV4dENvbnRlbnQgPSB1c2VyLm5hbWU7XG4gICAgICBwcm9maWxlRGVzY3JpcHRpb24udGV4dENvbnRlbnQgPSB1c2VyLmFib3V0O1xuICAgICAgcHJvZmlsZUF2YXRhci5zcmMgPSB1c2VyLmF2YXRhcjtcbiAgICAgIGNhcmRzTGlzdC5pbm5lckhUTUwgPSBcIlwiOyAvLyBDbGVhciBleGlzdGluZyBjYXJkc1xuICAgICAgY2FyZHMuZm9yRWFjaCgoaXRlbSkgPT4gcmVuZGVyQ2FyZChpdGVtLCBcImFwcGVuZFwiKSk7XG4gICAgfSlcbiAgICAuY2F0Y2goKGVycikgPT4gY29uc29sZS5lcnJvcihcIkZhaWxlZCB0byBsb2FkIGluaXRpYWwgZGF0YTpcIiwgZXJyKSk7XG59XG5cbi8vIENhcmQgY3JlYXRpb24gZnVuY3Rpb25cbmZ1bmN0aW9uIGdldENhcmRFbGVtZW50KGRhdGEpIHtcbiAgY29uc29sZS5sb2coXCJDcmVhdGluZyBjYXJkIHdpdGggZGF0YTpcIiwgZGF0YSk7IC8vIERlYnVnOiBMb2cgY2FyZCBkYXRhXG4gIGNvbnN0IGNhcmRFbGVtZW50ID0gY2FyZFRlbXBsYXRlLmNvbnRlbnRcbiAgICAucXVlcnlTZWxlY3RvcihcIi5jYXJkXCIpXG4gICAgLmNsb25lTm9kZSh0cnVlKTtcbiAgY29uc3QgY2FyZE5hbWVFbCA9IGNhcmRFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZF9fdGl0bGVcIik7XG4gIGNvbnN0IGNhcmRJbWFnZUVsID0gY2FyZEVsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5jYXJkX19pbWFnZVwiKTtcbiAgY29uc3QgY2FyZExpa2VCdG4gPSBjYXJkRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRfX2xpa2UtYnRuXCIpO1xuICBjb25zdCBjYXJkRGVsZXRlQnRuID0gY2FyZEVsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5jYXJkX19kZWxldGUtYnRuXCIpO1xuXG4gIGNhcmROYW1lRWwudGV4dENvbnRlbnQgPSBkYXRhLm5hbWU7XG4gIGNhcmRJbWFnZUVsLnNyYyA9IGRhdGEubGluaztcbiAgY2FyZEltYWdlRWwuYWx0ID0gZGF0YS5uYW1lO1xuXG4gIC8vIENoZWNrIGlmIHRoZSBjdXJyZW50IHVzZXIgaGFzIGxpa2VkIHRoZSBjYXJkXG4gIGNvbnN0IGlzTGlrZWQgPSBkYXRhLmxpa2VzICYmIGRhdGEubGlrZXMuc29tZSgobGlrZSkgPT4gbGlrZS5faWQgPT09IHVzZXJJZCk7XG4gIGNvbnNvbGUubG9nKGBDYXJkICR7ZGF0YS5faWR9IGlzTGlrZWQ6ICR7aXNMaWtlZH1gKTsgLy8gRGVidWc6IExvZyBpbml0aWFsIGxpa2Ugc3RhdGVcbiAgaWYgKGlzTGlrZWQpIHtcbiAgICBjYXJkTGlrZUJ0bi5jbGFzc0xpc3QuYWRkKFwiY2FyZF9fbGlrZS1idG5fbGlrZWRcIik7XG4gIH1cblxuICBjYXJkRGVsZXRlQnRuLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PlxuICAgIGhhbmRsZURlbGV0ZUNhcmQoY2FyZEVsZW1lbnQsIGRhdGEpXG4gICk7XG4gIGNhcmRMaWtlQnRuLmFkZEV2ZW50TGlzdGVuZXIoXG4gICAgXCJjbGlja1wiLFxuICAgIGhhbmRsZUxpa2VDbGljay5iaW5kKG51bGwsIGNhcmRMaWtlQnRuLCBkYXRhKVxuICApO1xuICBjYXJkSW1hZ2VFbC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgIHByZXZpZXdNb2RhbEltYWdlLnNyYyA9IGRhdGEubGluaztcbiAgICBwcmV2aWV3TW9kYWxJbWFnZS5hbHQgPSBkYXRhLm5hbWU7XG4gICAgcHJldmlld01vZGFsQ2FwdGlvbi50ZXh0Q29udGVudCA9IGRhdGEubmFtZTtcbiAgICBvcGVuTW9kYWwocHJldmlld01vZGFsKTtcbiAgfSk7XG5cbiAgcmV0dXJuIGNhcmRFbGVtZW50O1xufVxuXG5mdW5jdGlvbiByZW5kZXJDYXJkKGl0ZW0sIG1ldGhvZCA9IFwicHJlcGVuZFwiKSB7XG4gIGNvbnN0IGNhcmRFbGVtZW50ID0gZ2V0Q2FyZEVsZW1lbnQoaXRlbSk7XG4gIGNhcmRzTGlzdFttZXRob2RdKGNhcmRFbGVtZW50KTtcbn1cblxuLy8gTW9kYWwgZnVuY3Rpb25zXG5mdW5jdGlvbiBvcGVuTW9kYWwobW9kYWwpIHtcbiAgbW9kYWwuY2xhc3NMaXN0LmFkZChcIm1vZGFsX29wZW5lZFwiKTtcbiAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImtleWRvd25cIiwgY2xvc2VNb2RhbEJ5RXNjYXBlKTtcbiAgbW9kYWwuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNlZG93blwiLCBjbG9zZU1vZGFsQnlPdmVybGF5Q2xpY2spO1xuICBhdmF0YXJDb250YWluZXIuY2xhc3NMaXN0LnJlbW92ZShcInByb2ZpbGVfX2F2YXRhci1jb250YWluZXItLWFjdGl2ZVwiKTtcbn1cblxuZnVuY3Rpb24gY2xvc2VNb2RhbChtb2RhbCkge1xuICBtb2RhbC5jbGFzc0xpc3QucmVtb3ZlKFwibW9kYWxfb3BlbmVkXCIpO1xuICBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKFwia2V5ZG93blwiLCBjbG9zZU1vZGFsQnlFc2NhcGUpO1xuICBtb2RhbC5yZW1vdmVFdmVudExpc3RlbmVyKFwibW91c2Vkb3duXCIsIGNsb3NlTW9kYWxCeU92ZXJsYXlDbGljayk7XG4gIGF2YXRhckNvbnRhaW5lci5jbGFzc0xpc3QucmVtb3ZlKFwicHJvZmlsZV9fYXZhdGFyLWNvbnRhaW5lci0tYWN0aXZlXCIpO1xufVxuXG4vLyBGb3JtIGhhbmRsZXJzIHdpdGggXCJTYXZpbmcuLi5cIiBzdGF0ZVxuZnVuY3Rpb24gaGFuZGxlRWRpdEZvcm1TdWJtaXQoZXZ0KSB7XG4gIGV2dC5wcmV2ZW50RGVmYXVsdCgpO1xuICBjb25zdCBzdWJtaXRCdG4gPSBldnQuc3VibWl0dGVyO1xuICBjb25zdCBvcmlnaW5hbFRleHQgPSBzdWJtaXRCdG4udGV4dENvbnRlbnQ7XG4gIHN1Ym1pdEJ0bi50ZXh0Q29udGVudCA9IFwiU2F2aW5nLi4uXCI7XG4gIGNvbnN0IG5hbWUgPSBlZGl0TW9kYWxOYW1lSW5wdXQudmFsdWU7XG4gIGNvbnN0IGFib3V0ID0gZWRpdE1vZGFsRGVzY3JpcHRpb25JbnB1dC52YWx1ZTtcbiAgYXBpXG4gICAgLmVkaXRVc2VySW5mbyh7IG5hbWUsIGFib3V0IH0pXG4gICAgLnRoZW4oKHVzZXIpID0+IHtcbiAgICAgIHByb2ZpbGVOYW1lLnRleHRDb250ZW50ID0gdXNlci5uYW1lO1xuICAgICAgcHJvZmlsZURlc2NyaXB0aW9uLnRleHRDb250ZW50ID0gdXNlci5hYm91dDtcbiAgICAgIGNsb3NlTW9kYWwoZWRpdE1vZGFsKTtcbiAgICB9KVxuICAgIC5jYXRjaCgoZXJyKSA9PiBjb25zb2xlLmVycm9yKFwiRmFpbGVkIHRvIHVwZGF0ZSBwcm9maWxlOlwiLCBlcnIpKVxuICAgIC5maW5hbGx5KCgpID0+IChzdWJtaXRCdG4udGV4dENvbnRlbnQgPSBvcmlnaW5hbFRleHQpKTtcbn1cblxuZnVuY3Rpb24gaGFuZGxlQWRkQ2FyZFN1Ym1pdChldnQpIHtcbiAgZXZ0LnByZXZlbnREZWZhdWx0KCk7XG4gIGNvbnN0IHN1Ym1pdEJ0biA9IGV2dC5zdWJtaXR0ZXI7XG4gIGNvbnN0IG9yaWdpbmFsVGV4dCA9IHN1Ym1pdEJ0bi50ZXh0Q29udGVudDtcbiAgc3VibWl0QnRuLnRleHRDb250ZW50ID0gXCJTYXZpbmcuLi5cIjtcbiAgY29uc3QgbmFtZSA9IGNhcmRDYXB0aW9uSW5wdXQudmFsdWU7XG4gIGNvbnN0IGxpbmsgPSBjYXJkTGlua0lucHV0LnZhbHVlO1xuICBhcGlcbiAgICAuYWRkQ2FyZCh7IG5hbWUsIGxpbmsgfSlcbiAgICAudGhlbigoY2FyZCkgPT4ge1xuICAgICAgcmVuZGVyQ2FyZChjYXJkKTtcbiAgICAgIGNsb3NlTW9kYWwoY2FyZE1vZGFsKTtcbiAgICAgIGNhcmRGb3JtLnJlc2V0KCk7XG4gICAgICB0b2dnbGVCdXR0b25TdGF0ZShbY2FyZENhcHRpb25JbnB1dCwgY2FyZExpbmtJbnB1dF0sIHN1Ym1pdEJ0biwgc2V0dGluZ3MpO1xuICAgIH0pXG4gICAgLmNhdGNoKChlcnIpID0+IGNvbnNvbGUuZXJyb3IoXCJGYWlsZWQgdG8gYWRkIGNhcmQ6XCIsIGVycikpXG4gICAgLmZpbmFsbHkoKCkgPT4gKHN1Ym1pdEJ0bi50ZXh0Q29udGVudCA9IG9yaWdpbmFsVGV4dCkpO1xufVxuXG5mdW5jdGlvbiBoYW5kbGVBdmF0YXJGb3JtU3VibWl0KGV2dCkge1xuICBldnQucHJldmVudERlZmF1bHQoKTtcbiAgY29uc3Qgc3VibWl0QnRuID0gZXZ0LnN1Ym1pdHRlcjtcbiAgY29uc3Qgb3JpZ2luYWxUZXh0ID0gc3VibWl0QnRuLnRleHRDb250ZW50O1xuICBzdWJtaXRCdG4udGV4dENvbnRlbnQgPSBcIlNhdmluZy4uLlwiO1xuICBjb25zdCBhdmF0YXJVcmwgPSBhdmF0YXJVcmxJbnB1dC52YWx1ZTtcbiAgYXBpXG4gICAgLnVwZGF0ZUF2YXRhcihhdmF0YXJVcmwpXG4gICAgLnRoZW4oKHVzZXIpID0+IHtcbiAgICAgIHByb2ZpbGVBdmF0YXIuc3JjID0gdXNlci5hdmF0YXI7XG4gICAgICBjbG9zZU1vZGFsKGF2YXRhck1vZGFsKTtcbiAgICB9KVxuICAgIC5jYXRjaCgoZXJyKSA9PiBjb25zb2xlLmVycm9yKFwiRmFpbGVkIHRvIHVwZGF0ZSBhdmF0YXI6XCIsIGVycikpXG4gICAgLmZpbmFsbHkoKCkgPT4gKHN1Ym1pdEJ0bi50ZXh0Q29udGVudCA9IG9yaWdpbmFsVGV4dCkpO1xufVxuXG5mdW5jdGlvbiBoYW5kbGVEZWxldGVDYXJkKGNhcmRFbGVtZW50LCBkYXRhKSB7XG4gIHNlbGVjdGVkQ2FyZCA9IGNhcmRFbGVtZW50O1xuICBzZWxlY3RlZENhcmRJZCA9IGRhdGEuX2lkO1xuICBvcGVuTW9kYWwoZGVsZXRlTW9kYWwpO1xufVxuXG5mdW5jdGlvbiBoYW5kbGVEZWxldGVTdWJtaXQoZXZ0KSB7XG4gIGV2dC5wcmV2ZW50RGVmYXVsdCgpO1xuICBjb25zdCBzdWJtaXRCdG4gPSBldnQuc3VibWl0dGVyO1xuICBjb25zdCBvcmlnaW5hbFRleHQgPSBzdWJtaXRCdG4udGV4dENvbnRlbnQ7XG4gIHN1Ym1pdEJ0bi50ZXh0Q29udGVudCA9IFwiU2F2aW5nLi4uXCI7XG4gIGFwaVxuICAgIC5yZW1vdmVDYXJkKHNlbGVjdGVkQ2FyZElkKVxuICAgIC50aGVuKCgpID0+IHtcbiAgICAgIHNlbGVjdGVkQ2FyZC5yZW1vdmUoKTtcbiAgICAgIGNsb3NlTW9kYWwoZGVsZXRlTW9kYWwpO1xuICAgICAgc2VsZWN0ZWRDYXJkID0gbnVsbDtcbiAgICAgIHNlbGVjdGVkQ2FyZElkID0gbnVsbDtcbiAgICB9KVxuICAgIC5jYXRjaCgoZXJyKSA9PiBjb25zb2xlLmVycm9yKFwiRmFpbGVkIHRvIGRlbGV0ZSBjYXJkOlwiLCBlcnIpKVxuICAgIC5maW5hbGx5KCgpID0+IChzdWJtaXRCdG4udGV4dENvbnRlbnQgPSBvcmlnaW5hbFRleHQpKTtcbn1cblxuZnVuY3Rpb24gaGFuZGxlTGlrZUNsaWNrKGxpa2VCdG4sIGRhdGEpIHtcbiAgY29uc3QgaXNMaWtlZCA9IGxpa2VCdG4uY2xhc3NMaXN0LmNvbnRhaW5zKFwiY2FyZF9fbGlrZS1idG5fbGlrZWRcIik7XG4gIGNvbnNvbGUubG9nKGBMaWtlIGJ1dHRvbiBjbGlja2VkLCBpc0xpa2VkOiAke2lzTGlrZWR9LCBDYXJkIElEOiAke2RhdGEuX2lkfWApOyAvLyBEZWJ1Z1xuICBjb25zdCBtZXRob2QgPSBpc0xpa2VkID8gYXBpLnJlbW92ZUxpa2UuYmluZChhcGkpIDogYXBpLmFkZExpa2UuYmluZChhcGkpO1xuICBtZXRob2QoZGF0YS5faWQpXG4gICAgLnRoZW4oKHVwZGF0ZWRDYXJkKSA9PiB7XG4gICAgICBjb25zb2xlLmxvZyhcIkxpa2UgdXBkYXRlIHJlc3BvbnNlOlwiLCB1cGRhdGVkQ2FyZCk7IC8vIERlYnVnXG4gICAgICBjb25zdCBuZXdJc0xpa2VkID1cbiAgICAgICAgdXBkYXRlZENhcmQubGlrZXMgJiZcbiAgICAgICAgdXBkYXRlZENhcmQubGlrZXMuc29tZSgobGlrZSkgPT4gbGlrZS5faWQgPT09IHVzZXJJZCk7XG4gICAgICBsaWtlQnRuLmNsYXNzTGlzdC50b2dnbGUoXCJjYXJkX19saWtlLWJ0bl9saWtlZFwiLCBuZXdJc0xpa2VkKTtcbiAgICB9KVxuICAgIC5jYXRjaCgoZXJyKSA9PiBjb25zb2xlLmVycm9yKFwiRmFpbGVkIHRvIHVwZGF0ZSBsaWtlOlwiLCBlcnIpKTtcbn1cblxuLy8gRXZlbnQgbGlzdGVuZXJzXG5wcm9maWxlRWRpdEJ0bi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICBlZGl0TW9kYWxOYW1lSW5wdXQudmFsdWUgPSBwcm9maWxlTmFtZS50ZXh0Q29udGVudDtcbiAgZWRpdE1vZGFsRGVzY3JpcHRpb25JbnB1dC52YWx1ZSA9IHByb2ZpbGVEZXNjcmlwdGlvbi50ZXh0Q29udGVudDtcbiAgcmVzZXRWYWxpZGF0aW9uKGVkaXRGb3JtRWxlbWVudCwgc2V0dGluZ3MpO1xuICBvcGVuTW9kYWwoZWRpdE1vZGFsKTtcbn0pO1xuXG5jYXJkTW9kYWxCdG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IG9wZW5Nb2RhbChjYXJkTW9kYWwpKTtcbmF2YXRhckVkaXRMaW5rLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoZXZ0KSA9PiB7XG4gIGV2dC5wcmV2ZW50RGVmYXVsdCgpO1xuICBhdmF0YXJVcmxJbnB1dC52YWx1ZSA9IHByb2ZpbGVBdmF0YXIuc3JjO1xuICByZXNldFZhbGlkYXRpb24oYXZhdGFyRm9ybSwgc2V0dGluZ3MpO1xuICBvcGVuTW9kYWwoYXZhdGFyTW9kYWwpO1xufSk7XG5cbmVkaXRNb2RhbENsb3NlQnRuLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiBjbG9zZU1vZGFsKGVkaXRNb2RhbCkpO1xuY2FyZE1vZGFsQ2xvc2VCdG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IGNsb3NlTW9kYWwoY2FyZE1vZGFsKSk7XG5wcmV2aWV3TW9kYWxDbG9zZUJ0bi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4gY2xvc2VNb2RhbChwcmV2aWV3TW9kYWwpKTtcbmF2YXRhck1vZGFsQ2xvc2VCdG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IGNsb3NlTW9kYWwoYXZhdGFyTW9kYWwpKTtcbmRlbGV0ZU1vZGFsQ2xvc2VCdG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IGNsb3NlTW9kYWwoZGVsZXRlTW9kYWwpKTtcbmRlbGV0ZU1vZGFsQ2FuY2VsQnRuLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiBjbG9zZU1vZGFsKGRlbGV0ZU1vZGFsKSk7XG5cbmVkaXRGb3JtRWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwic3VibWl0XCIsIGhhbmRsZUVkaXRGb3JtU3VibWl0KTtcbmNhcmRGb3JtLmFkZEV2ZW50TGlzdGVuZXIoXCJzdWJtaXRcIiwgaGFuZGxlQWRkQ2FyZFN1Ym1pdCk7XG5hdmF0YXJGb3JtLmFkZEV2ZW50TGlzdGVuZXIoXCJzdWJtaXRcIiwgaGFuZGxlQXZhdGFyRm9ybVN1Ym1pdCk7XG5kZWxldGVGb3JtLmFkZEV2ZW50TGlzdGVuZXIoXCJzdWJtaXRcIiwgaGFuZGxlRGVsZXRlU3VibWl0KTtcblxuLy8gVG91Y2ggZXZlbnRzIGZvciBhdmF0YXJcbmF2YXRhckNvbnRhaW5lci5hZGRFdmVudExpc3RlbmVyKFwidG91Y2hzdGFydFwiLCAoZXZ0KSA9PiB7XG4gIGF2YXRhckNvbnRhaW5lci5jbGFzc0xpc3QudG9nZ2xlKFwicHJvZmlsZV9fYXZhdGFyLWNvbnRhaW5lci0tYWN0aXZlXCIpO1xufSk7XG5kb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKFwidG91Y2hzdGFydFwiLCAoZXZ0KSA9PiB7XG4gIGlmICghYXZhdGFyQ29udGFpbmVyLmNvbnRhaW5zKGV2dC50YXJnZXQpKSB7XG4gICAgYXZhdGFyQ29udGFpbmVyLmNsYXNzTGlzdC5yZW1vdmUoXCJwcm9maWxlX19hdmF0YXItY29udGFpbmVyLS1hY3RpdmVcIik7XG4gIH1cbn0pO1xuXG5mdW5jdGlvbiBjbG9zZU1vZGFsQnlFc2NhcGUoZXZ0KSB7XG4gIGlmIChldnQua2V5ID09PSBcIkVzY2FwZVwiKSB7XG4gICAgY29uc3Qgb3BlbmVkTW9kYWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX29wZW5lZFwiKTtcbiAgICBpZiAob3BlbmVkTW9kYWwpIGNsb3NlTW9kYWwob3BlbmVkTW9kYWwpO1xuICB9XG59XG5cbmZ1bmN0aW9uIGNsb3NlTW9kYWxCeU92ZXJsYXlDbGljayhldnQpIHtcbiAgaWYgKGV2dC50YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKFwibW9kYWxcIikpIHtcbiAgICBjbG9zZU1vZGFsKGV2dC50YXJnZXQpO1xuICB9XG59XG5cbi8vIEluaXRpYWxpemVcbmxvYWRJbml0aWFsRGF0YSgpO1xuZW5hYmxlVmFsaWRhdGlvbihzZXR0aW5ncyk7XG4iLCIvLyB1dGlscy9BcGkuanNcblxuY2xhc3MgQXBpIHtcbiAgY29uc3RydWN0b3IoeyBiYXNlVXJsLCBoZWFkZXJzIH0pIHtcbiAgICB0aGlzLmJhc2VVcmwgPSBiYXNlVXJsO1xuICAgIHRoaXMuaGVhZGVycyA9IGhlYWRlcnM7XG4gIH1cblxuICAvLyBIZWxwZXIgbWV0aG9kIHRvIGhhbmRsZSByZXNwb25zZXNcbiAgX2NoZWNrUmVzcG9uc2UocmVzKSB7XG4gICAgaWYgKCFyZXMub2spIHtcbiAgICAgIHJldHVybiByZXMudGV4dCgpLnRoZW4oKHRleHQpID0+IHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBIVFRQIGVycm9yISBTdGF0dXM6ICR7cmVzLnN0YXR1c30gLSAke3RleHR9YCk7XG4gICAgICB9KTtcbiAgICB9XG4gICAgcmV0dXJuIHJlcy5qc29uKCk7XG4gIH1cblxuICAvLyBGZXRjaCB1c2VyIGluZm8gYW5kIGNhcmRzIHRvZ2V0aGVyXG4gIGdldEFwcEluZm8oKSB7XG4gICAgcmV0dXJuIFByb21pc2UuYWxsKFt0aGlzLmdldFVzZXJJbmZvKCksIHRoaXMuZ2V0SW5pdGlhbENhcmRzKCldKS50aGVuKFxuICAgICAgKFt1c2VyLCBjYXJkc10pID0+ICh7IHVzZXIsIGNhcmRzIH0pXG4gICAgKTtcbiAgfVxuXG4gIC8vIEZldGNoIHVzZXIgaW5mb1xuICBnZXRVc2VySW5mbygpIHtcbiAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5iYXNlVXJsfS91c2Vycy9tZWAsIHtcbiAgICAgIGhlYWRlcnM6IHRoaXMuaGVhZGVycyxcbiAgICB9KS50aGVuKHRoaXMuX2NoZWNrUmVzcG9uc2UpO1xuICB9XG5cbiAgLy8gRmV0Y2ggaW5pdGlhbCBjYXJkc1xuICBnZXRJbml0aWFsQ2FyZHMoKSB7XG4gICAgcmV0dXJuIGZldGNoKGAke3RoaXMuYmFzZVVybH0vY2FyZHNgLCB7XG4gICAgICBoZWFkZXJzOiB0aGlzLmhlYWRlcnMsXG4gICAgfSkudGhlbih0aGlzLl9jaGVja1Jlc3BvbnNlKTtcbiAgfVxuXG4gIC8vIEVkaXQgcHJvZmlsZSB0ZXh0XG4gIGVkaXRVc2VySW5mbyh7IG5hbWUsIGFib3V0IH0pIHtcbiAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5iYXNlVXJsfS91c2Vycy9tZWAsIHtcbiAgICAgIG1ldGhvZDogXCJQQVRDSFwiLFxuICAgICAgaGVhZGVyczogdGhpcy5oZWFkZXJzLFxuICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoeyBuYW1lLCBhYm91dCB9KSxcbiAgICB9KS50aGVuKHRoaXMuX2NoZWNrUmVzcG9uc2UpO1xuICB9XG5cbiAgLy8gQWRkIGEgbmV3IGNhcmRcbiAgYWRkQ2FyZCh7IG5hbWUsIGxpbmsgfSkge1xuICAgIHJldHVybiBmZXRjaChgJHt0aGlzLmJhc2VVcmx9L2NhcmRzYCwge1xuICAgICAgbWV0aG9kOiBcIlBPU1RcIixcbiAgICAgIGhlYWRlcnM6IHRoaXMuaGVhZGVycyxcbiAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHsgbmFtZSwgbGluayB9KSxcbiAgICB9KS50aGVuKHRoaXMuX2NoZWNrUmVzcG9uc2UpO1xuICB9XG5cbiAgLy8gRGVsZXRlIGEgY2FyZFxuICByZW1vdmVDYXJkKGNhcmRJZCkge1xuICAgIHJldHVybiBmZXRjaChgJHt0aGlzLmJhc2VVcmx9L2NhcmRzLyR7Y2FyZElkfWAsIHtcbiAgICAgIG1ldGhvZDogXCJERUxFVEVcIixcbiAgICAgIGhlYWRlcnM6IHRoaXMuaGVhZGVycyxcbiAgICB9KS50aGVuKHRoaXMuX2NoZWNrUmVzcG9uc2UpO1xuICB9XG5cbiAgLy8gQWRkIGEgbGlrZVxuICBhZGRMaWtlKGNhcmRJZCkge1xuICAgIHJldHVybiBmZXRjaChgJHt0aGlzLmJhc2VVcmx9L2NhcmRzLyR7Y2FyZElkfS9saWtlc2AsIHtcbiAgICAgIG1ldGhvZDogXCJQVVRcIixcbiAgICAgIGhlYWRlcnM6IHRoaXMuaGVhZGVycyxcbiAgICB9KS50aGVuKHRoaXMuX2NoZWNrUmVzcG9uc2UpO1xuICB9XG5cbiAgLy8gUmVtb3ZlIGEgbGlrZVxuICByZW1vdmVMaWtlKGNhcmRJZCkge1xuICAgIHJldHVybiBmZXRjaChgJHt0aGlzLmJhc2VVcmx9L2NhcmRzLyR7Y2FyZElkfS9saWtlc2AsIHtcbiAgICAgIG1ldGhvZDogXCJERUxFVEVcIixcbiAgICAgIGhlYWRlcnM6IHRoaXMuaGVhZGVycyxcbiAgICB9KS50aGVuKHRoaXMuX2NoZWNrUmVzcG9uc2UpO1xuICB9XG5cbiAgLy8gVXBkYXRlIGF2YXRhclxuICB1cGRhdGVBdmF0YXIoYXZhdGFyVXJsKSB7XG4gICAgcmV0dXJuIGZldGNoKGAke3RoaXMuYmFzZVVybH0vdXNlcnMvbWUvYXZhdGFyYCwge1xuICAgICAgbWV0aG9kOiBcIlBBVENIXCIsXG4gICAgICBoZWFkZXJzOiB0aGlzLmhlYWRlcnMsXG4gICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7IGF2YXRhcjogYXZhdGFyVXJsIH0pLFxuICAgIH0pLnRoZW4odGhpcy5fY2hlY2tSZXNwb25zZSk7XG4gIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgQXBpO1xuIl0sIm5hbWVzIjpbInNldHRpbmdzIiwiZm9ybVNlbGVjdG9yIiwiaW5wdXRTZWxlY3RvciIsInN1Ym1pdEJ1dHRvblNlbGVjdG9yIiwiaW5hY3RpdmVCdXR0b25DbGFzcyIsImlucHV0RXJyb3JDbGFzcyIsImVycm9yQ2xhc3MiLCJoaWRlSW5wdXRFcnJvciIsImZvcm1FbCIsImlucHV0RWwiLCJjb25maWciLCJxdWVyeVNlbGVjdG9yIiwiaWQiLCJ0ZXh0Q29udGVudCIsImNsYXNzTGlzdCIsInJlbW92ZSIsInRvZ2dsZUJ1dHRvblN0YXRlIiwiaW5wdXRMaXN0IiwiYnV0dG9uRWwiLCJzb21lIiwiaW5wdXQiLCJ2YWxpZGl0eSIsInZhbGlkIiwiaGFzSW52YWxpZElucHV0IiwiZGlzYWJsZWQiLCJhZGQiLCJyZXNldFZhbGlkYXRpb24iLCJBcnJheSIsImZyb20iLCJxdWVyeVNlbGVjdG9yQWxsIiwiZm9yRWFjaCIsImFwaSIsImNvbnN0cnVjdG9yIiwiX3JlZiIsImJhc2VVcmwiLCJoZWFkZXJzIiwidGhpcyIsIl9jaGVja1Jlc3BvbnNlIiwicmVzIiwib2siLCJqc29uIiwidGV4dCIsInRoZW4iLCJFcnJvciIsInN0YXR1cyIsImdldEFwcEluZm8iLCJQcm9taXNlIiwiYWxsIiwiZ2V0VXNlckluZm8iLCJnZXRJbml0aWFsQ2FyZHMiLCJfcmVmMiIsInVzZXIiLCJjYXJkcyIsImZldGNoIiwiZWRpdFVzZXJJbmZvIiwiX3JlZjMiLCJuYW1lIiwiYWJvdXQiLCJtZXRob2QiLCJib2R5IiwiSlNPTiIsInN0cmluZ2lmeSIsImFkZENhcmQiLCJfcmVmNCIsImxpbmsiLCJyZW1vdmVDYXJkIiwiY2FyZElkIiwiYWRkTGlrZSIsInJlbW92ZUxpa2UiLCJ1cGRhdGVBdmF0YXIiLCJhdmF0YXJVcmwiLCJhdmF0YXIiLCJhdXRob3JpemF0aW9uIiwicHJvZmlsZUVkaXRCdG4iLCJkb2N1bWVudCIsImNhcmRNb2RhbEJ0biIsInByb2ZpbGVOYW1lIiwicHJvZmlsZURlc2NyaXB0aW9uIiwicHJvZmlsZUF2YXRhciIsImVkaXRNb2RhbCIsImNhcmRNb2RhbCIsInByZXZpZXdNb2RhbCIsImF2YXRhck1vZGFsIiwiZGVsZXRlTW9kYWwiLCJlZGl0Rm9ybUVsZW1lbnQiLCJmb3JtcyIsImNhcmRGb3JtIiwiYXZhdGFyRm9ybSIsImRlbGV0ZUZvcm0iLCJlZGl0TW9kYWxDbG9zZUJ0biIsImNhcmRNb2RhbENsb3NlQnRuIiwicHJldmlld01vZGFsQ2xvc2VCdG4iLCJhdmF0YXJNb2RhbENsb3NlQnRuIiwiZGVsZXRlTW9kYWxDbG9zZUJ0biIsImRlbGV0ZU1vZGFsQ2FuY2VsQnRuIiwiZWRpdE1vZGFsTmFtZUlucHV0IiwiZWRpdE1vZGFsRGVzY3JpcHRpb25JbnB1dCIsImNhcmRMaW5rSW5wdXQiLCJjYXJkQ2FwdGlvbklucHV0IiwiYXZhdGFyVXJsSW5wdXQiLCJhdmF0YXJFZGl0TGluayIsImF2YXRhckNvbnRhaW5lciIsImNhcmRUZW1wbGF0ZSIsImNhcmRzTGlzdCIsInByZXZpZXdNb2RhbEltYWdlIiwicHJldmlld01vZGFsQ2FwdGlvbiIsInNlbGVjdGVkQ2FyZCIsInNlbGVjdGVkQ2FyZElkIiwidXNlcklkIiwiZ2V0Q2FyZEVsZW1lbnQiLCJkYXRhIiwiY29uc29sZSIsImxvZyIsImNhcmRFbGVtZW50IiwiY29udGVudCIsImNsb25lTm9kZSIsImNhcmROYW1lRWwiLCJjYXJkSW1hZ2VFbCIsImNhcmRMaWtlQnRuIiwiY2FyZERlbGV0ZUJ0biIsInNyYyIsImFsdCIsImlzTGlrZWQiLCJsaWtlcyIsImxpa2UiLCJfaWQiLCJhZGRFdmVudExpc3RlbmVyIiwib3Blbk1vZGFsIiwiaGFuZGxlRGVsZXRlQ2FyZCIsImhhbmRsZUxpa2VDbGljayIsImJpbmQiLCJyZW5kZXJDYXJkIiwiaXRlbSIsImFyZ3VtZW50cyIsImxlbmd0aCIsInVuZGVmaW5lZCIsIm1vZGFsIiwiY2xvc2VNb2RhbEJ5RXNjYXBlIiwiY2xvc2VNb2RhbEJ5T3ZlcmxheUNsaWNrIiwiY2xvc2VNb2RhbCIsInJlbW92ZUV2ZW50TGlzdGVuZXIiLCJsaWtlQnRuIiwiY29udGFpbnMiLCJ1cGRhdGVkQ2FyZCIsIm5ld0lzTGlrZWQiLCJ0b2dnbGUiLCJjYXRjaCIsImVyciIsImVycm9yIiwiZXZ0Iiwia2V5Iiwib3BlbmVkTW9kYWwiLCJ0YXJnZXQiLCJ2YWx1ZSIsInByZXZlbnREZWZhdWx0Iiwic3VibWl0QnRuIiwic3VibWl0dGVyIiwib3JpZ2luYWxUZXh0IiwiZmluYWxseSIsImNhcmQiLCJyZXNldCIsImlubmVySFRNTCIsInNldEV2ZW50TGlzdGVuZXJzIiwiYnV0dG9uRWxlbWVudCIsImlucHV0RWxlbWVudCIsImNoZWNrSW5wdXRWYWxpZGl0eSIsInNob3dJbnB1dEVycm9yIiwiZXJyb3JNc2ciLCJ2YWxpZGF0aW9uTWVzc2FnZSJdLCJzb3VyY2VSb290IjoiIn0=